---
title: 大前端笔记之23 🐈 Git
date: 2020-02-21 21:17:12
abbrlink: wmjtf4cp
tags: 
categories: 大前端
excerpt: Git 是目前最主流的分布式版本管理系统，它可以将项目多个不同的版本状态保存起来，以便随时取回之前的版本进行重写或查阅。
---

# 大前端笔记之23 🐈 Git

Git 是目前最主流的分布式版本管理系统，它可以将项目多个不同的版本状态保存起来，以便随时取回之前的版本进行重写或查阅。

既然有分布式，那么与之相对的便是集中式，比如 SVN。集中式版本管理是将版本库保存在一个统一的中央服务器，其它用户都需要通过网络连接中央服务器，如果要修改项目，则需要先从中央服务器获取到版本库的文件，修改完成后再提交回去。而分布式版本管理则是将版本库保存到用户本机上，如果有需要，则只需两个人同步，就能获取到对方更新后的版本了。

## 安装与配置

首先在[官网](https://git-scm.com/downloads )下载对应版本的 Git，根据提示安装即可。

打开任意文件夹，右键选择`Git Bash Here`，打开 Git 的命令行窗口，输入`git --version`，如果出现版本号信息（如`git version 2.24.0.windows.2`），则说明安装成功。

在第一次使用 Git 之前，需要先配置提交人的姓名和邮箱。其中的`--global`表示全局配置，即本地所有的仓库都采用该配置。

```powershell
git config --global user.name 小鸡米花         # 配置姓名
git config --global user.email test@163.com   # 配置邮箱
git config --list                             # 查看所有配置信息
```

## 提交修改

在使用 Git 之前，需要先明确几个概念。首先，用户编辑文件的项目目录称为**工作区**，也就是电脑上能直接看到的目录。当文件发生修改后，需要先将文件添加到**暂存区**，如果有多个文件就可以添加多次，它类似于购物车，当你选好所有的商品后一并付款，这样可以将多个文件的变更统一作为一个版本修改。当本次暂存区的所有文件修改完毕后，将它们一并提交到**仓库**，进行持久化保存。

### 初始化仓库

在项目文件夹下使用`git init`命令初始化仓库，此时项目文件夹会出现一个`.git`的隐藏文件夹。它是当前项目的版本管理仓库，暂存区和仓库都保存在这里。

### 添加到暂存区

在项目文件夹下随便新建一个文本文件`index.html`，然后使用命令`git add index.html`告诉 Git 跟踪该文件，也就是将该文件添加到暂存区。

### 提交到仓库

使用`git commit -m 提交内容`将跟踪的文件提交到仓库保存，也就是将暂存区的文件提交到仓库。Git 会提示提交的文件数量，新增和删除了多少行数据。其中`-m`之后表示这次提交的内容，**必须写**清楚以便之后查阅。否则会弹出一个文件要求输入提交内容，关闭文件之后才会继续提交操作。

> 注意，版本管理工具不能跟踪二进制文件内容的变化，只能跟踪它们的大小或日期。

### 查看仓库状态

然后对文件进行一些修改，使用`git status`命令，可以查看当前仓库的状态。其中第一行括号提示文件没有被跟踪，以红色的文件名标识；第二行括号提示`index.html`文件发生了修改，但是还没有被提交。

![](https://ae01.alicdn.com/kf/H30b97f8b14d545a7bee29a40f72c4b0a7.jpg)

接下来继续使用`git add index.html`和`git commit -m "第一次修改"`提交修改，再使用`git status`命令，便提示没有需要提交的内容了。

### 比较差异

使用`git diff`命令可以查看工作区文件与暂存区文件有哪些不同。使用`git diff --cached`命令可以查看暂存区文件与仓库文件（最近的一次提交）有哪些不同。

## 时光机穿梭

### 查看提交记录

使用`git log`命令可以查看所有的仓库提交记录，每条记录以一长串的字符作为本次提交的`id`，下面是提交的作者和时间。如果感觉信息太乱，可以使用`git log --pretty=oneline`命令隐藏作者和时间，使其显示在一行。

![](https://ae01.alicdn.com/kf/H18c7b498c4a3437e98dd2f490bea9f92m.jpg)

第一条记录后面括号中的`HEAD`表示这是最近的一次提交（后面的`master`表示主分支，见下文）。

> 如果记录显示后控制台不能操作，按下<kbd>Q</kbd>即可。

### 回退版本

如果希望回退到上一个的版本，使用`git reset --hard HEAD`命令，其中`HEAD`表示上一个版本，`HEAD^`表示上上个版本。当版本回退之后，使用`git log`命令就无法再查看最新的版本了（比如`c7c9f2`开头的这条就消失了），如果要回到这条版本，则需要使用`git reset --hard c7c9f2`命令，后面的编号为记录编号，不需要写全，通常取前 6 位即可。

但是，如果关闭了控制台，那么新版本编号就看不到了，此时需要使用`git reflog`命令查看指令输入的历史记录，从中就可以找到对应的编号了。

![](https://ae01.alicdn.com/kf/H2d91db357384459c817ffb66b1672556a.jpg)

### 撤销修改

如果修改了文件内容，还没有提交到暂存区，那么使用`git checkout -- 文件名`可以撤销工作区的修改。

如果修改了文件内容，而且提交到暂存区了，那么使用`git reset HEAD 文件名`可以将暂存区恢复为最近的一次提交，这样就回到了第一步。

如果修改了文件内容，而且不但提交到了暂存区，也提交到了本地仓库，那么直接回退版本。

如果修改了文件内容，而且还提交到了远程仓库（见下文），那么就等着 GG 吧。

### 删除文件

如果要删除工作区的文件，那么可以使用`git rm 文件名`命令，该命令会自动将删除操作同步到暂存区。如果已经先手动删除了文件，那么也需要使用该命令将操作同步。接下来继续使用`git commit`命令提交修改到仓库，那么该文件就会从仓库中被删除。

如果要恢复被删除的文件，与上文撤销修改其实是一样的。

### 忽略文件

实际开发中由于一次添加的文件比较多，如果手动去挨个添加会比较繁琐。Git 提供了忽略文件清单的功能，在项目文件夹下新建一个后缀为`.gitignore`的文件（不需要文件名），在其中写明要忽略的文件或文件夹（如果省略了后缀名，那么 Git 会将其识别为文件夹），那么 Git 就不会跟踪这些文件了。

```powershell
# .gitignore

test.html
public/test_images
```

接下来，只需要使用`git add .`命令就可以将所有文件添加到暂存区了。

## 分支

之前的操作都是在一条时间线上完成的，这条时间线被称为**主分支**（master）。分支可以使不同的工作分开进行，例如开发分支、功能分支、Bug 修复分支等。

严格说来，`HEAD`直接指向的并不是最近的一次提交，而是指向的`master`，而`master`指向的才是最近一次提交。

![](https://ae01.alicdn.com/kf/H74a57d0d493f47a28d69f436183a543fF.jpg)

当新的分支创建后，Git 会创建一个新的指针，指向当前最近一次提交，并将`HEAD`指向该分支指针。

![](https://ae01.alicdn.com/kf/Hf6b95de15895464092eec989a286d2adZ.jpg)

接下来，对工作区的操作就会针对该`dev`分支了，当再次提交新版本时，`master`依然指向原来的版本，而`dev`则指向了新提交的版本。

![](https://ae01.alicdn.com/kf/H4271a66fd65d40f8ad5697757e58ccd1K.jpg)

如果`dev`的工作完成了，就可以将该分支合并到主分支上，所谓合并，其实将`master`重新指向最新版本，并将`HEAD`指向它。

![](https://ae01.alicdn.com/kf/H3b3ad377372f42b8870b28015ab4168aW.jpg)

最后，只需要删除掉`dev`指针，那么就只剩下一条主分支了。

![](https://ae01.alicdn.com/kf/H6216e25f96354ccfbc280e532138086aZ.jpg)

使用`git branch`命令可以查看目前所有的分支。分支前的`*`和绿色字体表示这是当前分支。

使用`git branch dev`命令可以基于当前分支创建一个`dev`分支。

使用`git checkout dev`命令或者`git switch dev`可以切换到`dev`分支。

上述两条命令可以简写成`git checkout -b dev`或者`git switch -c dev`一条。

> 由于`checkout`命令既用于撤销修改，又用于切换分支，容易令人迷惑，因此新版本中添加了`switch`命令用来切换分支。

使用`git merge dev`命令可以将当前分支与`dev`分支合并。

使用`git branch -d dev`命令可以将`dev`分支删除，不过要求该分支必须被合并，防止误删。使用`git branch -D dev`命令可以强制删除分支。

## GitHub

上述的所有操作都是在本地仓库完成的，如果需要与其他人协作，那么就需要一个公共区域供大家下载和推送自己本地的代码。GitHub 是目前世界上最流行的远程仓库和多人协作开发平台，开发者 A 可以将本地的仓库推送到 GitHub 上的远程仓库，然后开发者 B 就可以将其拉取下来，在本地开发完成后再推送到远程仓库，这样就可以完成协作了。

在 GitHub 上注册账号后，需要先创建一个远程仓库（repository）。点击导航栏右上角的加号，选择`New repository`即可打开创建新仓库的页面。在页面中填写项目名称`test`，选择默认的`public`即公开权限，点击下面的绿色按钮创建即可。

![](https://ae01.alicdn.com/kf/Hd8e883f7a2884658b6bbeb601a23fa8eg.jpg)

### 推送本地仓库

项目管理者将仓库创建完成后，进入该仓库页面。首先，使用`git push 远程仓库地址 分支名称`命令（如`git push https://github.com/ChickenPopcorny/test.git master`）将本地仓库推送到远程仓库。这时会弹出一个窗口，提示输入该账号的用户名和密码（之后系统会将其保存起来，不需要再次输入）。推送完成后，在远程仓库页面刷新，就可以看到推送的文件了。

但是每次粘贴地址比较麻烦，因此可以先使用`git remote add origin https://github.com/ChickenPopcorny/test.git`命令为远程地址起一个别名`origin`（自定义的，可以修改），然后再使用`git push origin master`命令就可以了。

如果使用`git push -u origin master`命令，那么表示将当前远程地址和分支作为临时的默认推送地址，那么之后只需要使用`git push`即可。

### 克隆远程仓库

其它合作开发者使用`git clone https://github.com/ChickenPopcorny/test.git`命令可以将远程仓库克隆到本地仓库。克隆命令不需要权限，因为仓库的权限是公共的。

### 邀请合作开发者

合作开发者克隆仓库后，并不能直接使用`push`命令将修改推送到远程仓库，因为没有权限。管理者需要在项目的设置页面添加想要邀请的合作开发者，而且合作开发者需要接受邀请后，才能使用`push`命令推送修改。

![](https://ae01.alicdn.com/kf/H91859d7d81f442f3ab9564a41c8359f0f.jpg)

### 拉取最新版本

合作开发者提交版本后，管理者可以通过`git pull 远程仓库地址 分支名称`命令将最新版本拉取到本地仓库并自动合并。与克隆命令不同的是，克隆命令是在本地仓库不存在的情况下使用，而后续只需要使用拉取命令即可。而且，如果远程仓库版本高于本地，那么本地是不能推送的，必须先使用`pull`命令获取最新版本，才能进行推送。