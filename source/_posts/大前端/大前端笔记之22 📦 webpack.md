---
title: å¤§å‰ç«¯ç¬”è®°ä¹‹22 ğŸ“¦ webpack
date: 2020-02-20 16:21:01
abbrlink: 1zcig0yl
tags: webpack
categories: å¤§å‰ç«¯
excerpt: webpack æ˜¯ä¸€ä¸ªå‰ç«¯é¡¹ç›®çš„è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï¼Œæ›´ç¡®åˆ‡åœ°æ¥è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¨¡å—æ‰“åŒ…å™¨ã€‚æ¨¡å—åŒ–å¯ä»¥ä½¿å¾—è¶Šæ¥è¶Šå¤æ‚çš„å‰ç«¯é¡¹ç›®ä¸­çš„æ–‡ä»¶ä¾èµ–å˜å¾—æ¸…æ™°ï¼Œæ›´å®¹æ˜“ç®¡ç†ã€‚ä½†æ˜¯ç”±äºæµè§ˆå™¨çš„å…¼å®¹æ€§é—®é¢˜ï¼ŒES6ã€CommonJS ç­‰æ¨¡å—åŒ–è¯­æ³•å¹¶ä¸èƒ½å¾—åˆ°å¾ˆå¥½çš„æ”¯æŒã€‚è€Œ webpack æä¾›äº†å„ç§æ¨¡å—åŒ–æ–¹å¼çš„æ”¯æŒï¼Œå¯ä»¥å°†è¿™äº›åŒ…å«æ¨¡å—åŒ–è¯­æ³•çš„ä»£ç è¿›è¡Œæ‰“åŒ…åˆå¹¶ï¼Œè½¬æ¢æˆæµè§ˆå™¨èƒ½å¤Ÿè¿è¡Œçš„ä»£ç ã€‚å¯è§ï¼Œè™½ç„¶å®ƒä¹Ÿå…·æœ‰ç±»ä¼¼äº Gulp æä¾›è¯¸å¦‚ä»£ç è½¬æ¢ï¼ˆES6 â†’ ES5ã€Less â†’ CSS ï¼‰ã€ä»£ç å‹ç¼©ç­‰åŠŸèƒ½ï¼Œä½†æ˜¯æä¾›æ¨¡å—åŒ–æ”¯æŒï¼Œæ‰æ˜¯å®ƒæ›´å¼ºå¤§çš„åœ°æ–¹ã€‚
---

# å¤§å‰ç«¯ç¬”è®°ä¹‹22 ğŸ“¦ webpack

[webpack](https://www.webpackjs.com/concepts)æ˜¯ä¸€ä¸ªå‰ç«¯é¡¹ç›®çš„è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï¼Œæ›´ç¡®åˆ‡åœ°æ¥è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¨¡å—æ‰“åŒ…å™¨ã€‚æ¨¡å—åŒ–å¯ä»¥ä½¿å¾—è¶Šæ¥è¶Šå¤æ‚çš„å‰ç«¯é¡¹ç›®ä¸­çš„æ–‡ä»¶ä¾èµ–å˜å¾—æ¸…æ™°ï¼Œæ›´å®¹æ˜“ç®¡ç†ã€‚ä½†æ˜¯ç”±äºæµè§ˆå™¨çš„å…¼å®¹æ€§é—®é¢˜ï¼ŒES6ã€CommonJS ç­‰æ¨¡å—åŒ–è¯­æ³•å¹¶ä¸èƒ½å¾—åˆ°å¾ˆå¥½çš„æ”¯æŒã€‚è€Œ webpack æä¾›äº†å„ç§æ¨¡å—åŒ–æ–¹å¼çš„æ”¯æŒï¼Œå¯ä»¥å°†è¿™äº›åŒ…å«æ¨¡å—åŒ–è¯­æ³•çš„ä»£ç è¿›è¡Œæ‰“åŒ…åˆå¹¶ï¼Œè½¬æ¢æˆæµè§ˆå™¨èƒ½å¤Ÿè¿è¡Œçš„ä»£ç ã€‚å¯è§ï¼Œè™½ç„¶å®ƒä¹Ÿå…·æœ‰ç±»ä¼¼äº Gulp æä¾›è¯¸å¦‚ä»£ç è½¬æ¢ï¼ˆES6 â†’ ES5ã€Less â†’ CSS ï¼‰ã€ä»£ç å‹ç¼©ç­‰åŠŸèƒ½ï¼Œä½†æ˜¯æä¾›æ¨¡å—åŒ–æ”¯æŒï¼Œæ‰æ˜¯å®ƒæ›´å¼ºå¤§çš„åœ°æ–¹ã€‚

## åŸºæœ¬æ¦‚å¿µ

webpack æ˜¯ä¸€ä¸ªåŸºäº Node.js çš„å·¥å…·ï¼Œéœ€è¦ä½¿ç”¨ npm å®‰è£…ã€‚ç”±äºå®ƒä»…ä»…æ˜¯ä¸€ä¸ªå¼€å‘å·¥å…·ï¼Œå› æ­¤å°†å…¶ä½œä¸ºå¼€å‘ä¾èµ–å³å¯ï¼š

```powershell
npm i webpack webpack-cli --save-dev
```

æ¥ä¸‹æ¥åœ¨é¡¹ç›®ç›®å½•ä¸­æ–°å»ºä¸€ä¸ª`src`ç›®å½•ï¼Œç”¨æ¥å­˜æ”¾æºä»£ç æ–‡ä»¶ï¼Œç­‰å¾… webpack å¤„ç†ã€‚

```powershell
test
â”œâ”€ node_modules         # æ¨¡å—æ–‡ä»¶å¤¹
â”œâ”€ package-lock.json
â”œâ”€ package.json         # ä½¿ç”¨ npm init ç”Ÿæˆçš„
â”œâ”€ index.html           # ç”¨äºå¼•å…¥æ‰“åŒ…åçš„ js æ–‡ä»¶ï¼Œä¸´æ—¶æ”¾åˆ°è¿™é‡Œä½œä¸ºæµ‹è¯•
â””â”€ src                  # å­˜æ”¾æºä»£ç æ–‡ä»¶
    â””â”€ index.js         # éšä¾¿å†™äº†ä¸€è¡Œ console.log() ä»£ç 
```

æ¥ä¸‹æ¥ä½¿ç”¨[npx](/posts/o48l9v2o.html#npx)æ‰§è¡Œ webpack è¿›è¡Œé¡¹ç›®æ‰“åŒ…ã€‚

```powershell
npx webpack
```

æ­¤æ—¶ä¼šå‘ç°é¡¹ç›®ä¸‹å¤šå‡ºäº†ä¸€ä¸ª`dist`æ–‡ä»¶å¤¹ï¼Œå®ƒç”¨æ¥å­˜æ”¾å¤„ç†åçš„ä»£ç ï¼Œå½“å‰åŒ…å«äº†æ‰“åŒ…åçš„`main.js`æ–‡ä»¶ã€‚æ‰“å¼€è¯¥æ–‡ä»¶å‘ç°ï¼Œè™½ç„¶æºæ–‡ä»¶ä¸­åªæœ‰ä¸€è¡Œ`console.log()`ï¼Œä½†æ˜¯æ‰“åŒ…åçš„æ–‡ä»¶æ˜¯ç»è¿‡å‹ç¼©åçš„ä¸€ä¸²å¤æ‚ä»£ç ï¼Œè¿™æ˜¯å› ä¸º webpack æä¾›äº†æ¨¡å—åŒ–æ”¯æŒã€‚

ç„¶ååœ¨`index.html`å¼•å…¥åˆšç”Ÿæˆçš„`main.js`ï¼Œå¯ä»¥å‘ç°æºæ–‡ä»¶`index.js`ä¸­çš„ä»£ç è¢«æ­£ç¡®æ‰§è¡Œäº†ã€‚

å¦‚æœè¦ä¿®æ”¹ webpack çš„é…ç½®ï¼Œéœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª`webpack.config.js`æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œä¸”**åªèƒ½ä½¿ç”¨ CommonJS è¯­æ³•**ï¼Œå› æ­¤é…ç½®å¯¹è±¡éœ€è¦é€šè¿‡æ¨¡å—åŒ–å¯¼å‡ºã€‚

```js
/* webpack.config.js */
module.exports = {
    // é…ç½®å‚æ•°
}
```

## loader

webpack é™¤äº†å¯ä»¥ç®¡ç† JavaScript æ–‡ä»¶ä»¥å¤–ï¼Œä¹Ÿå¯ä»¥ç®¡ç†è¯¸å¦‚ CSSã€å›¾ç‰‡ç­‰å„ç§é™æ€èµ„æºï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥ä½¿ç”¨æ¨¡å—åŒ–è¯­æ³•ç›´æ¥å¯¼å…¥è¿™äº›å…¶å®ƒç±»å‹çš„èµ„æºæ–‡ä»¶ï¼Œè€Œä¸ä»…ä»…æ˜¯ JavaScript æ–‡ä»¶ã€‚ä¸è¿‡ï¼Œè¦ç®¡ç†è¿™äº›èµ„æºï¼Œéœ€è¦é¦–å…ˆå®‰è£…å¯¹åº”çš„ loaderï¼Œä¸åŒçš„èµ„æºæœ‰ä¸åŒçš„ loaderï¼Œå¯¹åº”çš„é…ç½®æ–¹å¼ä¹Ÿä¸å¤ªç›¸åŒã€‚

### æ ·å¼æ–‡ä»¶

ç®¡ç† CSS æ ·å¼æ–‡ä»¶éœ€è¦ä½¿ç”¨[css-loader](https://www.webpackjs.com/loaders/css-loader/)å’Œ[style-loader](https://www.webpackjs.com/loaders/style-loader/)ä¸¤ä¸ª loaderï¼Œå‰è€…è´Ÿè´£å¯¼å…¥ CSS æ–‡ä»¶å¹¶æä¾›è¿”å›çš„ CSS ä»£ç ï¼Œåè€…è´Ÿè´£å°† CSS ä»£ç åµŒå…¥åˆ°é¡µé¢çš„ DOM ä½¿å…¶ç”Ÿæ•ˆã€‚å› æ­¤ä½ åªéœ€åœ¨é¡µé¢ä¸­å¼•ç”¨ä¸€ä¸ªè¾“å‡ºçš„ JavaScript æ–‡ä»¶ï¼Œå°±å¯ä»¥ä½¿é¡µé¢æ‹¥æœ‰æ ·å¼äº†ï¼

```powershell
npm install style-loader css-loader --save-dev 
```

```js
module.exports = {
    module: {
        rules: [{
            test: /\.css$/,
            use: ['style-loader', 'css-loader']
        }]
    }
}
```

> æ³¨æ„é…ç½®æ–‡ä»¶ä¸­åŠ è½½ loader çš„é¡ºåºï¼Œæ˜¯**ä»å³å‘å·¦**æ‰§è¡Œçš„ï¼Œå› æ­¤`css-loader`å¿…é¡»è¦å†™åœ¨åé¢ï¼ˆå…ˆæ‰§è¡Œï¼‰æ‰èƒ½æ­£ç¡®è¿è¡Œã€‚

å¦‚æœè¿˜éœ€è¦ç®¡ç† Less æ–‡ä»¶ï¼Œåˆ™éœ€è¦ä½¿ç”¨[less-loader](https://www.webpackjs.com/loaders/less-loader/)å’Œ Less æœ¬èº«ã€‚å¹¶ä¸”ç”±äº Less æœ€ç»ˆä¾ç„¶ä¼šè½¬æ¢ä¸º CSSï¼Œå› æ­¤ä¹Ÿéœ€è¦ä¾èµ–`css-loader`å’Œ`style-loader`ã€‚

```powershell
npm install --save-dev less-loader less
```

```js
module.exports = {
    module: {
        rules: [{
            test: /\.less$/,
            use: ['style-loader', 'css-loader', 'less-loader']
        }]
    }
}
```

> æ³¨æ„ï¼Œè™½ç„¶è¿™é‡Œçš„è§„åˆ™ä¸­ä¹Ÿä½¿ç”¨äº†`css-loader`å’Œ`less-loader`ï¼Œä½†æ˜¯å¦‚æœå¸Œæœ›æ­£ç¡®å¤„ç† CSS æ–‡ä»¶çš„è¯ï¼Œä¾ç„¶éœ€è¦ä¹‹å‰ CSS çš„è§„åˆ™ï¼Œè¿™é‡Œçš„è§„åˆ™ä»…ä»…ç”¨äºç®¡ç† Less æ–‡ä»¶ï¼Œä¸ä¼šç®¡ç† CSS æ–‡ä»¶ã€‚

### å›¾ç‰‡æ–‡ä»¶

å½“å…¶å®ƒæ–‡ä»¶ä¸­å¼•å…¥å›¾ç‰‡æ–‡ä»¶æ—¶ï¼ˆæ¯”å¦‚ CSS æ–‡ä»¶ä¸­é€šè¿‡`url()`è®¾ç½®äº†èƒŒæ™¯å›¾ç‰‡ï¼‰ï¼Œé‚£ä¹ˆéœ€è¦ä½¿ç”¨[file-loader](https://www.webpackjs.com/loaders/file-loader/)æ¥ç®¡ç†å›¾ç‰‡æ–‡ä»¶ã€‚

```powershell
npm install --save-dev file-loader
```

```js
module.exports = {
    module: {
        rules: [{
            test: /\.(png|jpg|gif)$/,
            use: ['file-loader']
        }]
    }
}
```

å¯ä»¥çœ‹åˆ°`dist`ç›®å½•ä¸­ç”Ÿæˆäº†ä¸€ä¸ªéšæœºæ–‡ä»¶åçš„å›¾ç‰‡æ–‡ä»¶ï¼Œä¸è¿‡ç”±äºæ­¤æ—¶`index.html`æ–‡ä»¶çš„ä½ç½®é—®é¢˜å¯¼è‡´å›¾ç‰‡è·¯å¾„ä¸æ­£ç¡®ï¼Œå› æ­¤å›¾ç‰‡æ— æ³•æ­£å¸¸æ˜¾ç¤ºï¼Œä¹‹åå¤„ç† HTML æ–‡ä»¶æ—¶å°±ä¼šè§£å†³è¿™ä¸ªé—®é¢˜ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨[url-loader](https://www.webpackjs.com/loaders/url-loader/)å°†æ¯”è¾ƒå°çš„å›¾ç‰‡è½¬æ¢æˆ Base64ã€‚å½“å›¾ç‰‡çš„ä½“ç§¯å°äº`limit`ï¼ˆå•ä½ä¸ºå­—èŠ‚ï¼‰æ—¶ï¼Œwebpack ä¼šå°†å›¾ç‰‡è½¬æ¢ä¸º Base64ã€‚å¦‚æœå¤§äº`limit`ï¼Œåˆ™ä¼šè‡ªåŠ¨è°ƒç”¨ file-loaderã€‚

> æ³¨æ„ï¼ä¸€æ—¦é…ç½®äº† url-loaderï¼Œè™½ç„¶ file-loader å¿…é¡»å®‰è£…ï¼Œä½†æ˜¯**åƒä¸‡ä¸è¦é…ç½®**ï¼å¦åˆ™ä¼šç”±äºå†²çªå¯¼è‡´æ‰“åŒ…ç»“æœä¸æ­£ç¡®ï¼

```powershell
npm install --save-dev url-loader
```

```js
module.exports = {
    module: {
        rules: [{
            test: /\.(png|jpg|gif)$/,
            use: [
                {
                    loader: 'url-loader',
                    options: {
                        limit: 8192 // ç›¸å½“äº 8KB
                    }
                }
            ]
        }]
    }
}
```

### Babel

ä½¿ç”¨[babel-loader](https://www.webpackjs.com/loaders/babel-loader/)å¯ä»¥å°† ES6 è¯­æ³•è½¬æ¢æˆå…¼å®¹æ€§æ¯”è¾ƒå¥½çš„ ES5 è¯­æ³•ã€‚

```powershell
npm install -D babel-loader @babel/core @babel/preset-env
```

```js
module.exports = {
    module: {
        rules: [{
            test: /\.m?js$/,
            exclude: /(node_modules|bower_components)/,
            use: {
                loader: 'babel-loader',
                options: {
                    presets: ['@babel/preset-env']
                }
            }
        }]
    }
}
```

## ç®¡ç†è¾“å‡º

### å…¥å£

ä½¿ç”¨`entry`è®¾ç½®é¡¹ç›®çš„èµ·ç‚¹ï¼Œé»˜è®¤ä¸º`./src/index.js`ã€‚

```js
module.exports = {
    entry: './src/main.js' // ä¿®æ”¹ä¸º main.js æ–‡ä»¶
}
```

### å‡ºå£

ä½¿ç”¨`output`è®¾ç½®ç¼–è¯‘åçš„æ–‡ä»¶åç§°å’Œä¿å­˜ä½ç½®ï¼Œé»˜è®¤ä¸º`./dist/main.js`ã€‚è¯¥å±æ€§æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒåŒ…å«`path`å’Œ`filename`ä¸¤ä¸ªå±æ€§ï¼Œå‰è€…ç”¨æ¥è®¾ç½®ä¿å­˜ä½ç½®ï¼Œåè€…è®¾ç½®æ–‡ä»¶åç§°ã€‚æ³¨æ„ï¼Œå…¶ä¸­`path`å¿…é¡»ä¸º**ç»å¯¹è·¯å¾„**ï¼Œå› æ­¤éœ€è¦å¼•å…¥`path`æ¨¡å—æ‹¼æ¥è·¯å¾„ã€‚

```js
const path = require('path')

module.exports = {
    output: { // å°†æ‰“åŒ…åçš„æ–‡ä»¶ä¿®æ”¹ä¸º é¡¹ç›®ç›®å½•ä¸‹çš„ output/bundle.js
        path: path.join(__dirname, 'output'),
        filename: 'bundle.js'
    }
}
```

## æ’ä»¶

æ’ä»¶å¯ä»¥å¯¹ webpack è¿›è¡ŒåŠŸèƒ½ä¸Šçš„æ‰©å……ï¼Œæ¯”å¦‚ä»£ç å‹ç¼©ã€æ·»åŠ ç‰ˆæƒä¿¡æ¯ç­‰ã€‚ä¸ loader ä¸åŒçš„æ˜¯ï¼Œloader ç”¨äºå°†ç‰¹å®šç±»å‹çš„æ–‡ä»¶è¿›è¡Œè½¬æ¢ï¼Œè€Œæ’ä»¶åˆ™æ˜¯å°†è½¬æ¢åçš„ä»£ç ä½œå‡ºè¿›ä¸€æ­¥å¤„ç†ã€‚

### è‡ªåŠ¨ç”Ÿæˆ HTML æ–‡ä»¶

ä½¿ç”¨[HtmlWebpackPlugin](https://github.com/jantimon/html-webpack-plugin#configuration)å¯ä»¥åœ¨å‘å¸ƒç›®å½•ä¸­è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª HTML æ–‡ä»¶ï¼Œå¹¶å¼•å…¥åŒ…å«æ‰“åŒ…å`.js`æ–‡ä»¶ã€‚

```powershell
npm i --save-dev html-webpack-plugin
```

```js
const HtmlWebpackPlugin = require('html-webpack-plugin')

module.exports = {
    plugins: [
        new HtmlWebpackPlugin()
    ]
}
```

è°ƒç”¨æ’ä»¶æ—¶å¯ä»¥ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ä½œä¸ºé…ç½®å‚æ•°ï¼Œæ¯”å¦‚å¸Œæœ›ä»¥è‡ªå®šä¹‰çš„æ¨¡æ¿æ¥åˆ›å»º HTMLï¼Œå¯ä»¥ä½¿ç”¨[template å±æ€§](https://github.com/jantimon/html-webpack-plugin/blob/master/docs/template-option.md)ã€‚å®ƒä¾ç„¶ä¼šè‡ªåŠ¨åœ¨æœ€åæ·»åŠ æ‰“åŒ…æ–‡ä»¶çš„å¼•ç”¨ï¼Œä¸éœ€è¦æ‰‹åŠ¨æ·»åŠ ã€‚

```js
module.exports = {
    plugins: [
        new HtmlWebpackPlugin({
            template: './index.html' // ç›¸å¯¹äº webpack.config.js æ–‡ä»¶æ‰€åœ¨ç›®å½•
        })
    ]
}
```

### ä»£ç å‹ç¼©

ä½¿ç”¨[UglifyjsWebpackPlugin](https://www.webpackjs.com/plugins/uglifyjs-webpack-plugin/)å¯ä»¥å¯¹ä»£ç è¿›è¡Œå‹ç¼©ã€‚

> åœ¨ webpack4 ä¸­ï¼Œå¦‚æœé…ç½®äº†`mode: 'production'`ï¼ˆé»˜è®¤ï¼‰é€‰é¡¹ï¼Œé‚£ä¹ˆ webpack ä¼šè‡ªåŠ¨è¿›è¡Œå‹ç¼©ï¼Œè¿™é‡Œç­‰ç”¨åˆ°æ—¶å†ç ”ç©¶ã€‚

## å…¶å®ƒåŠŸèƒ½

### æœ¬åœ°æœåŠ¡å™¨

ä½¿ç”¨[webpack-dev-server](https://www.webpackjs.com/configuration/dev-server/)å¯ä»¥å¿«é€Ÿæ„å»ºä¸€ä¸ªåŸºäº Node.js çš„æœ¬åœ°æœåŠ¡å™¨ï¼Œå®ƒå†…ç½®äº† [Express æ¡†æ¶](/posts/o48l9v2o.html#æ„å»ºç½‘ç»œæœåŠ¡)ï¼Œå¯ä»¥ç”¨äºæœ¬åœ°è°ƒè¯•ã€‚

```powershell
npm install webpack-dev-server --save-dev
```

```js
module.exports = {
    devServer: {
        contentBase: path.join(__dirname, "dist"), // æ ¹è·¯å¾„ï¼Œé€šå¸¸é…ç½®ä¸ºéƒ¨ç½²ç›®å½• dist
        port: 9000 // ç«¯å£ï¼Œé»˜è®¤ä¸º 8080
    }
}
```

ç„¶åè¿è¡Œé¡¹ç›®æœ¬åœ°çš„`webpack-server-dev`å¯åŠ¨æœåŠ¡å™¨ï¼Œä½¿ç”¨ npx æˆ–è€… npm scripts å‡å¯ã€‚

```powershell
npx webpack-server-dev
```

> ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ VSCode ä¸­çš„ live-server æ‰©å±•ã€‚

### åˆ†ç¦»é…ç½®æ–‡ä»¶

ä½¿ç”¨[webpack-merge](https://github.com/survivejs/webpack-merge)å¯ä»¥å°†é…ç½®æ–‡ä»¶åˆ†ç¦»æˆå¼€å‘ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒï¼Œç„¶åæ ¹æ®ç¯å¢ƒå†åˆå¹¶ä¸ºä¸€ä¸ªç»Ÿä¸€çš„é…ç½®æ–‡ä»¶ã€‚






