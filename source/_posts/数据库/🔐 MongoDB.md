---
title: ğŸ” MongoDB
date: 2020-02-09 13:57:38
abbrlink: e6q2910w
tags: MongoDB
categories: æ•°æ®åº“
excerpt: æ–½å·¥ä¸­...
---

# ğŸ” MongoDB

> æ–½å·¥ä¸­... ä¿®æ”¹æ—¶é—´

MongoDB ä¸ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“åŒºåˆ«åœ¨äºï¼Œå®ƒä¸éœ€è¦è®¾è®¡è¡¨ç»“æ„ï¼Œå­˜å–æ•°æ®æ›´åŠ çµæ´»ã€‚å®ƒä¿å­˜çš„ä¸æ˜¯è¡¨ï¼Œè€Œæ˜¯ä¸€ç§ç§°ä¸º BSON çš„æ•°æ®ç»“æ„ï¼Œå®ƒä¸ JSON éå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯æ¯” JSON å¼ºå¤§çš„ä¸€ç‚¹åœ¨äºï¼Œå®ƒå¯ä»¥ä¿å­˜äºŒè¿›åˆ¶æ•°æ®ï¼Œå…¶å®ƒä¸ JSON åŒºåˆ«ä¸å¤§ã€‚æ­£æ˜¯ç”±äºè¿™ä¸€ç‚¹ï¼ŒMongoDB çš„ä¸€äº›æ¦‚å¿µä¸å…³ç³»å‹æ•°æ®åº“æœ‰æ‰€ä¸åŒï¼š

| SQL | MongoDB | æè¿° |
| --- | --- | --- |
| database | database | æ•°æ®åº“ |
| table | collection | è¡¨ / é›†åˆ |
| row | document | è¡Œ / æ–‡æ¡£ |

## å®‰è£…ä¸é…ç½®

åœ¨[å®˜ç½‘](https://www.mongodb.com/download-center/community)å¯ä»¥ä¸‹è½½ç¤¾åŒºç‰ˆï¼ˆéä¼ä¸šçº§å•†ç”¨ï¼‰çš„ MongoDBï¼Œå®‰è£…æ¯”è¾ƒç®€å•ï¼Œåœ¨è‡ªå®šä¹‰å®‰è£…ä¸‹å¯ä»¥ä¿®æ”¹è·¯å¾„ï¼Œé™¤æ­¤ä¹‹å¤–æ²¡æœ‰å…¶å®ƒé…ç½®ã€‚å®‰è£…çš„è¿‡ç¨‹ä¸­ä¼šæç¤ºå®‰è£… MongoDB Compass å›¾å½¢åŒ–ç•Œé¢ï¼Œä½†æ˜¯è¿™ä¸ªå¹¶ä¸å¥½ç”¨ï¼Œå»ºè®®ç›´æ¥ä½¿ç”¨ Navicatï¼ˆæœ€æ–°ç‰ˆæœ¬æ”¯æŒ MongoDBï¼‰ã€‚

å®‰è£…å®Œæˆåï¼Œå°†å®‰è£…è·¯å¾„ä¸‹çš„`bin`è·¯å¾„é…ç½®åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼ˆå¦‚`C:\MongoDB\Server\bin`ï¼‰ï¼Œä»¥ä¾¿å‘½ä»¤è¡Œè°ƒç”¨ã€‚

ç³»ç»ŸæœåŠ¡ä¸‹çš„`MongoDB Server`ä¸º MongoDB çš„æœåŠ¡ï¼Œåœ¨ä½¿ç”¨ MongoDB ä¹‹å‰è®°å¾—å…ˆå¯åŠ¨å®ƒã€‚

å¼€å¯ CMD è¾“å…¥`mongo`å³å¯è¿›å…¥ MongoDB çš„å‘½ä»¤è¡Œå·¥å…·ã€‚åœ¨å‘½ä»¤è¡Œå·¥å…·ä¸­è¾“å…¥`show databases`æŸ¥çœ‹æ‰€æœ‰çš„æ•°æ®åº“ï¼Œå¦‚æœèƒ½æ­£å¸¸æ˜¾ç¤ºï¼Œåˆ™è¯´æ˜è¿æ¥æˆåŠŸã€‚

å®‰è£…ç›®å½•ä¸‹çš„`data`æ–‡ä»¶å¤¹ä¿å­˜äº†æ•°æ®åº“æ–‡ä»¶ï¼Œå¦‚æœè¦ä¿®æ”¹ä¿å­˜ä½ç½®ï¼Œéœ€è¦æ‰“å¼€`bin\mongod.cfg`ï¼Œä¿®æ”¹å…¶ä¸­çš„`dbPath`ä¸€é¡¹ã€‚è¯¥æ–‡ä»¶æ˜¯æ•°æ®åº“çš„é…ç½®æ–‡ä»¶ï¼Œå¾ˆå¤šé€‰é¡¹éƒ½å¯ä»¥åœ¨è¿™é‡Œä¿®æ”¹ã€‚

## æ“ä½œæ•°æ®åº“å’Œé›†åˆ

ä½¿ç”¨`use æ•°æ®åº“å`å¯ä»¥åˆ‡æ¢å½“å‰ä½¿ç”¨çš„æ•°æ®åº“ã€‚æ³¨æ„ï¼Œå³ä½¿è¿™ä¸ªæ•°æ®åº“ä¸å­˜åœ¨ï¼Œä¹Ÿæ˜¯å¯ä»¥ç›´æ¥åˆ‡æ¢çš„ã€‚å› ä¸º MongoDB ä¸­çš„**æ•°æ®åº“å’Œé›†åˆä¸éœ€è¦æ‰‹åŠ¨åˆ›å»º**ï¼Œåœ¨ç¬¬ä¸€æ¬¡å‘é›†åˆä¸­æ’å…¥æ–‡æ¡£æ—¶ï¼Œå¯¹åº”çš„æ•°æ®åº“å’Œé›†åˆä¼šè‡ªåŠ¨åˆ›å»ºã€‚

```js
use test
```

ä½¿ç”¨`show collections`å¯ä»¥æŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰é›†åˆã€‚ç”±äºæ•°æ®åº“éƒ½è¿˜æ²¡æœ‰åˆ›å»ºï¼Œå› æ­¤æ­¤æ—¶çš„æ•°æ®åº“è‚¯å®šä¹Ÿæ˜¯ç©ºçš„ã€‚

## CRUD

ä½¿ç”¨`db.é›†åˆå`å¯ä»¥è°ƒç”¨ä¸‹åˆ—æ–¹æ³•ï¼Œè¿›è¡Œæ•°æ®åº“çš„ CRUD æ“ä½œã€‚å…¶ä¸­`db`æŒ‡å‘å½“å‰æ•°æ®åº“åï¼Œç±»ä¼¼äº`this`ï¼›è€Œé›†åˆåç±»ä¼¼äºè¡¨åï¼Œå¯ä»¥è‡ªå®šä¹‰ã€‚æ³¨æ„ï¼Œè¿™äº›æ–¹æ³•ä»…é€‚ç”¨äºæ§åˆ¶å°ï¼Œè€Œä¸æ˜¯ä¾›åç«¯è¯­è¨€è°ƒç”¨ã€‚

### æŸ¥è¯¢æ“ä½œç¬¦

[å®˜æ–¹æ–‡æ¡£](https://docs.mongodb.com/manual/reference/operator/query/)

```js
// æŸ¥è¯¢ name ä¸º 'Enter the Gungeon' çš„æ–‡æ¡£
Game.find({ name: 'Enter the Gungeon' })
// æŸ¥è¯¢ name ä¸º 'Resident Evil' ï¼Œä¸” type ä¸º 'AVG' çš„æ–‡æ¡£
Game.find({ name: 'Resident Evil', type: 'AVG' })
// æŸ¥è¯¢ age å¤§äº 15 å°äº 30 çš„æ–‡æ¡£
User.find({ age: { $gt: 15, $lt: 30 }})
// æŸ¥è¯¢ age ä¸ç­‰äº 20 çš„æ–‡æ¡£
User.find({ age: { $ne: 20 }})
// æŸ¥è¯¢ age ä¸º 10 æˆ– 14 æˆ– 20 çš„æ–‡æ¡£ 
User.find({ age: { $in: [10, 14, 20] }})
// æŸ¥è¯¢å…¨éƒ¨æ–‡æ¡£
Game.find()
```

### insert()

å‘é›†åˆä¸­æ’å…¥è‹¥å¹²æ¡æ–‡æ¡£ã€‚

* å‚æ•°â‘ ï¼šå¯¹è±¡æˆ–æ•°ç»„ï¼Œè¡¨ç¤ºæ’å…¥çš„æ•°æ®

```js
// æ’å…¥ä¸€æ¡æ–‡æ¡£
db.students.insert({ name:'å¾¡å‚ç¾ç´', age: 16 })
// æ’å…¥å¤šæ¡æ–‡æ¡£
db.students.insert([
	{ name: 'JOJO', age: 17 },
	{ name: 'Wendy', age: 14 }
])
```

æ­¤æ—¶ä½¿ç”¨`show databases`å’Œ`show collections`å°±å¯ä»¥çœ‹åˆ°è‡ªåŠ¨åˆ›å»ºçš„æ•°æ®åº“å’Œé›†åˆäº†ã€‚

æ³¨æ„ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸€æ¡æ–‡æ¡£å‰è‡ªåŠ¨æ·»åŠ äº†ä¸€ä¸ª`_id`å­—æ®µã€‚å®ƒç”¨æ¥ä½œä¸ºæ–‡æ¡£çš„å”¯ä¸€æ ‡è¯†ï¼Œä½†æ˜¯å…¶ç±»å‹ä¸ºæ¯”è¾ƒç‰¹æ®Šçš„`ObjectId`ï¼Œè¯¥ç±»å‹å¹¶ä¸æ˜¯æ™®é€šçš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰å¯¹è±¡ï¼Œå› æ­¤åœ¨å…¶å®ƒè¯­è¨€æŸ¥è¯¢æ•°æ®åº“æ—¶ï¼Œéœ€è¦é¢å¤–çš„å¤„ç†ã€‚

### find() / findOne()

æŸ¥è¯¢é›†åˆä¸­çš„ä¸€æ¡ / å¤šæ¡æ–‡æ¡£ã€‚

* å‚æ•°â‘ ï¼šå¯¹è±¡ï¼Œè¡¨ç¤ºæŸ¥è¯¢æ¡ä»¶
* è¿”å›å€¼ï¼šä»¥æ•°ç»„ / å¯¹è±¡å½¢å¼è¿”å›ç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£

```js
// æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£
db.students.find()
// æŸ¥è¯¢ç¬¦åˆå•ä¸ªæ¡ä»¶çš„æ–‡æ¡£ï¼Œæ³¨æ„è¿™é‡Œæ ¹æ® id æŸ¥è¯¢æ•°æ®çš„æ–¹å¼
db.students.find({ _id: ObjectId('5de238bbb52000002c000d74') })
// æŸ¥è¯¢åŒæ—¶ç¬¦åˆå¤šä¸ªæ¡ä»¶çš„æ–‡æ¡£
db.students.find({ name:'JOJO', age: 17 })
// æŸ¥è¯¢ç¬¬ä¸€æ¡ç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£
db.students.findOne({ age: 17 })
```

å¦‚æœä½¿ç”¨è¿”å›çš„ç»“æœç»§ç»­è°ƒç”¨`count()`ï¼Œå¯ä»¥è·å–æŸ¥è¯¢çš„ç»“æœæ•°ã€‚

```js
db.students.find().count() // => 5
```

### updateOne() / updateMany()

æ›´æ–°æ–‡æ¡£éœ€è¦ä½¿ç”¨**æ›´æ–°æ“ä½œç¬¦**ï¼Œå®ƒç”¨æ¥å¯¹æœ¬æ¬¡æ›´æ–°æ“ä½œè¿›è¡Œä¸€äº›é…ç½®ï¼Œä¾‹å¦‚å¯ä»¥æ›´æ–°å­—æ®µåã€å¯ä»¥æ›´æ–°å­—æ®µå€¼æˆ–è€…ç§»é™¤ä¸€ä¸ªå­—æ®µç­‰ã€‚

ä¿®æ”¹é›†åˆä¸­çš„ä¸€æ¡ / å¤šæ¡æ–‡æ¡£ã€‚

> * å‚æ•°â‘ ï¼šå¯¹è±¡ï¼Œè¡¨ç¤ºæŸ¥è¯¢æ¡ä»¶
> * å‚æ•°â‘¡ï¼šåŒ…å«æ›´æ–°æ“ä½œç¬¦çš„å¯¹è±¡

```js
// å°†ç¬¬ä¸€æ¡ age ä¸º 14 çš„æ•°æ®çš„ age å±æ€§å€¼æ›´æ–°ä¸º 23
db.students.updateOne({ age: 14 }, {
	$set: { age: 23 } // $set æ“ä½œç¬¦ç”¨æ¥æ›´æ–°å±æ€§å€¼
})
```

### deleteOne() / deleteMany()

åˆ é™¤é›†åˆä¸­çš„ä¸€æ¡ / å¤šæ¡æ–‡æ¡£ã€‚

> * å‚æ•°â‘ ï¼šå¯¹è±¡ï¼Œè¡¨ç¤ºæŸ¥è¯¢æ¡ä»¶

```js
// å°† _id ä¸º 5de238bbb52000002c000d74 çš„æ–‡æ¡£åˆ é™¤
db.students.deleteOne({ _id: ObjectId('5de238bbb52000002c000d74') })
```